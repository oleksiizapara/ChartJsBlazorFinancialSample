/*!
 * @license
 * chartjs-chart-financial
 * http://chartjs.org/
 * Version: 0.1.0
 *
 * Copyright 2019 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-chart-financial/blob/master/LICENSE.md
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],t):t((e=e||self).Chart)}(this,function(e){"use strict";var t=(e=e&&e.hasOwnProperty("default")?e.default:e).helpers,a={position:"left",ticks:{callback:e.Ticks.formatters.linear}},l=e.scaleService.getScaleConstructor("linear").extend({_parseValue:function(e){var t,a,l,n;return void 0!==e.c?(t=+this.getRightValue(e.l),a=+this.getRightValue(e.h),l=Math.min(t,a),n=Math.max(t,a)):(t=void 0,a=e=+this.getRightValue(e.y),l=e,n=e),{min:l,max:n,start:t,end:a}},determineDataLimits:function(){var e=this,a=e.chart,l=a.data.datasets,n=e.isHorizontal();e.min=null,e.max=null,t.each(l,function(l,i){var r=a.getDatasetMeta(i);a.isDatasetVisible(i)&&function(t){return n?t.xAxisID===e.id:t.yAxisID===e.id}(r)&&t.each(l.data,function(t,a){var l=e._parseValue(t);isNaN(l.min)||isNaN(l.max)||r.data[a].hidden||((null===e.min||l.min<e.min)&&(e.min=l.min),(null===e.max||e.max<l.max)&&(e.max=l.max))})});var i=.05*(e.max-e.min);e.min-=i,e.max+=i,this.handleTickRangeOptions()}});e.scaleService.registerScaleType("financialLinear",l,a);var n=e.helpers;e.defaults.financial={label:"",hover:{mode:"label"},scales:{xAxes:[{type:"time",distribution:"series",categoryPercentage:.8,barPercentage:.9,offset:!0,ticks:{source:"data"}}],yAxes:[{type:"financialLinear"}]},tooltips:{intersect:!1,mode:"index",callbacks:{label:function(t,a){var l=a.datasets[t.datasetIndex].data[t.index];return n.isNullOrUndef(l.y)?"O: "+l.o+"  H: "+l.h+"  L: "+l.l+"  C: "+l.c:e.defaults.global.tooltips.callbacks.label(t,a)}}}};var i=e.controllers.bar.extend({dataElementType:e.elements.Financial,_updateElementGeometry:function(e,t,a){var l=this,n=e._model,i=l._getValueScale(),r=i.getBasePixel(),o=i.isHorizontal(),c=l._ruler||l.getRuler(),d=l.calculateBarValuePixels(l.index,t),s=l.calculateBarIndexPixels(l.index,t,c),u=l.chart.data.datasets[l.index].data[t];n.horizontal=o,n.base=a?r:d.base,n.x=o?a?r:d.head:s.center,n.y=o?s.center:a?r:d.head,n.height=o?s.size:void 0,n.width=o?void 0:s.size,n.candleOpen=i.getPixelForValue(Number(u.o)),n.candleHigh=i.getPixelForValue(Number(u.h)),n.candleLow=i.getPixelForValue(Number(u.l)),n.candleClose=i.getPixelForValue(Number(u.c))},draw:function(){var t,a=this.chart.chart.ctx,l=this.getMeta().data,n=this.getDataset(),i=l.length,r=0;for(e.canvasHelpers.clipArea(a,this.chart.chartArea);r<i;++r)null==(t=n.data[r].o)||isNaN(t)||l[r].draw();e.canvasHelpers.unclipArea(a)}}),r=e.helpers;function o(e){var t,a,l=e._view,n=l.width/2;return t=l.x-n,a=l.x+n,{left:t,top:l.candleHigh,right:a,bottom:l.candleLow}}e.defaults.global.elements.financial={color:{up:"rgba(80, 160, 115, 1)",down:"rgba(215, 85, 65, 1)",unchanged:"rgba(90, 90, 90, 1)"}};var c=e.Element.extend({height:function(){var e=this._view;return e.base-e.y},inRange:function(e,t){var a=!1;if(this._view){var l=o(this);a=e>=l.left&&e<=l.right&&t>=l.top&&t<=l.bottom}return a},inLabelRange:function(e,t){if(!this._view)return!1;var a=o(this);return void 0!==this._view.width?e>=a.left&&e<=a.right:t>=a.top&&t<=a.bottom},inXRange:function(e){var t=o(this);return e>=t.left&&e<=t.right},inYRange:function(e){var t=o(this);return e>=t.top&&e<=t.bottom},getCenterPoint:function(){var e=this._view;return{x:e.x,y:(e.candleHigh+e.candleLow)/2}},getArea:function(){var e=this._view;return e.width*Math.abs(e.y-e.base)},tooltipPosition:function(){var e=this._view;return{x:e.x,y:(e.candleOpen+e.candleClose)/2}},hasValue:function(){var e=this._model;return r.isNumber(e.x)&&r.isNumber(e.candleOpen)&&r.isNumber(e.candleHigh)&&r.isNumber(e.candleLow)&&r.isNumber(e.candleClose)}}),d=e.helpers,s=e.defaults.global;s.elements.candlestick=d.merge({},[s.elements.financial,{borderColor:s.elements.financial.color.unchanged,borderWidth:1}]);var u=c.extend({draw:function(){var e,t=this._chart.ctx,a=this._view,l=a.x,n=a.candleOpen,i=a.candleHigh,r=a.candleLow,o=a.candleClose,c=a.borderColor;"string"==typeof c&&(c={up:c,down:c,unchanged:c}),o<n?(e=d.getValueOrDefault(c?c.up:void 0,s.elements.candlestick.borderColor),t.fillStyle=d.getValueOrDefault(a.color?a.color.up:void 0,s.elements.candlestick.color.up)):o>n?(e=d.getValueOrDefault(c?c.down:void 0,s.elements.candlestick.borderColor),t.fillStyle=d.getValueOrDefault(a.color?a.color.down:void 0,s.elements.candlestick.color.down)):(e=d.getValueOrDefault(c?c.unchanged:void 0,s.elements.candlestick.borderColor),t.fillStyle=d.getValueOrDefault(a.color?a.color.unchanged:void 0,s.elements.candlestick.color.unchanged)),t.lineWidth=d.getValueOrDefault(a.borderWidth,s.elements.candlestick.borderWidth),t.strokeStyle=d.getValueOrDefault(e,s.elements.candlestick.borderColor),t.beginPath(),t.moveTo(l,i),t.lineTo(l,Math.min(n,o)),t.moveTo(l,r),t.lineTo(l,Math.max(n,o)),t.stroke(),t.fillRect(l-a.width/2,o,a.width,n-o),t.strokeRect(l-a.width/2,o,a.width,n-o),t.closePath()}});e.defaults.candlestick=e.helpers.merge({},e.defaults.financial);e.controllers.candlestick=i.extend({dataElementType:u,updateElement:function(e,t,a){var l=this,n=l.getMeta(),i=l.getDataset();e._xScale=l.getScaleForId(n.xAxisID),e._yScale=l.getScaleForId(n.yAxisID),e._datasetIndex=l.index,e._index=t,e._model={datasetLabel:i.label||"",color:i.color,borderColor:i.borderColor,borderWidth:i.borderWidth},l._updateElementGeometry(e,t,a),e.pivot()}});var h=e.helpers,m=e.defaults.global;m.elements.ohlc=h.merge({},[m.elements.financial,{lineWidth:2,armLength:null,armLengthRatio:.8}]);var g=c.extend({draw:function(){var e=this._chart.ctx,t=this._view,a=t.x,l=t.candleOpen,n=t.candleHigh,i=t.candleLow,r=t.candleClose,o=h.getValueOrDefault(t.armLength,m.elements.ohlc.armLength),c=h.getValueOrDefault(t.armLengthRatio,m.elements.ohlc.armLengthRatio);null===o&&(o=t.width*c*.5),e.strokeStyle=r<l?h.getValueOrDefault(t.color?t.color.up:void 0,m.elements.ohlc.color.up):r>l?h.getValueOrDefault(t.color?t.color.down:void 0,m.elements.ohlc.color.down):h.getValueOrDefault(t.color?t.color.unchanged:void 0,m.elements.ohlc.color.unchanged),e.lineWidth=h.getValueOrDefault(t.lineWidth,m.elements.ohlc.lineWidth),e.beginPath(),e.moveTo(a,n),e.lineTo(a,i),e.moveTo(a-o,l),e.lineTo(a,l),e.moveTo(a+o,r),e.lineTo(a,r),e.stroke()}});e.defaults.ohlc=e.helpers.merge({},e.defaults.financial),e.defaults.ohlc.scales.xAxes[0].barPercentage=1,e.defaults.ohlc.scales.xAxes[0].categoryPercentage=1;e.controllers.ohlc=i.extend({dataElementType:g,updateElement:function(e,t,a){var l=this,n=l.getMeta(),i=l.getDataset();e._xScale=l.getScaleForId(n.xAxisID),e._yScale=l.getScaleForId(n.yAxisID),e._datasetIndex=l.index,e._index=t,e._model={datasetLabel:i.label||"",lineWidth:i.lineWidth,armLength:i.armLength,armLengthRatio:i.armLengthRatio,color:i.color},l._updateElementGeometry(e,t,a),e.pivot()}})});
